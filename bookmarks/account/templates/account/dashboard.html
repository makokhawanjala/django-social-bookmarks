{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
  .dashboard-container {
    padding: 0;
    margin: 0;
    background: var(--win11-bg);
  }

  .dashboard-header {
    background: var(--win11-content);
    border-bottom: 1px solid var(--win11-border);
    padding: 32px;
    margin-bottom: 24px;
  }

  .user-welcome {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
  }

  .user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--win11-border);
    background: var(--win11-hover);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: var(--win11-text-secondary);
  }

  .user-info h1 {
    font-size: 32px;
    font-weight: 600;
    color: var(--win11-text-primary);
    margin: 0 0 8px 0;
  }

  .user-info p {
    font-size: 16px;
    color: var(--win11-text-secondary);
    margin: 0;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: var(--win11-content);
    border: 1px solid var(--win11-border);
    border-radius: 12px;
    padding: 24px;
    transition: all 0.2s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .stat-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
  }

  .stat-icon.images {
    background: linear-gradient(135deg, #0078d4, #1ba1e2);
  }

  .stat-icon.bookmarks {
    background: linear-gradient(135deg, #198754, #20c997);
  }

  .stat-icon.activity {
    background: linear-gradient(135deg, #6f42c1, #8b5cf6);
  }

  .stat-icon.profile {
    background: linear-gradient(135deg, #fd7e14, #f59f00);
  }

  .stat-content h3 {
    font-size: 14px;
    font-weight: 500;
    color: var(--win11-text-secondary);
    margin: 0 0 4px 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-number {
    font-size: 32px;
    font-weight: 700;
    color: var(--win11-text-primary);
    margin: 0 0 8px 0;
  }

  .stat-description {
    font-size: 14px;
    color: var(--win11-text-secondary);
    margin: 0;
  }

  .dashboard-sections {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    margin-bottom: 32px;
  }

  .main-section {
    background: var(--win11-content);
    border: 1px solid var(--win11-border);
    border-radius: 12px;
    overflow: hidden;
  }

  .section-header {
    padding: 24px 24px 16px;
    border-bottom: 1px solid var(--win11-border);
  }

  .section-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--win11-text-primary);
    margin: 0 0 8px 0;
  }

  .section-subtitle {
    font-size: 14px;
    color: var(--win11-text-secondary);
    margin: 0;
  }

  .section-content {
    padding: 24px;
  }

  .bookmarklet-container {
    background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
    border: 2px dashed var(--win11-accent);
    border-radius: 12px;
    padding: 32px;
    text-align: center;
    margin-bottom: 24px;
  }

  .bookmarklet-icon {
    width: 64px;
    height: 64px;
    background: var(--win11-accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    color: white;
    font-size: 24px;
  }

  .bookmarklet-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--win11-text-primary);
    margin-bottom: 8px;
  }

  .bookmarklet-description {
    font-size: 14px;
    color: var(--win11-text-secondary);
    margin-bottom: 20px;
    line-height: 1.5;
  }

  .bookmarklet-button {
    display: inline-block;
    background: var(--win11-accent);
    color: white;
    text-decoration: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.2s ease;
    border: 2px solid var(--win11-accent);
  }

  .bookmarklet-button:hover {
    background: #146c43;
    color: white;
    text-decoration: none;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
  }

  .quick-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .action-button {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--win11-hover);
    border: 1px solid var(--win11-border);
    border-radius: 8px;
    text-decoration: none;
    color: var(--win11-text-primary);
    transition: all 0.2s ease;
  }

  .action-button:hover {
    background: #e9ecef;
    color: var(--win11-text-primary);
    text-decoration: none;
    transform: translateY(-1px);
  }

  .action-icon {
    width: 32px;
    height: 32px;
    background: var(--win11-accent);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
  }

  .action-text {
    font-size: 14px;
    font-weight: 500;
  }

  .sidebar-section {
    background: var(--win11-content);
    border: 1px solid var(--win11-border);
    border-radius: 12px;
    height: fit-content;
  }

  .recent-activity {
    padding: 24px;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--win11-border);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--win11-hover);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--win11-text-secondary);
    font-size: 14px;
  }

  .activity-content {
    flex: 1;
  }

  .activity-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--win11-text-primary);
    margin: 0 0 2px 0;
  }

  .activity-time {
    font-size: 12px;
    color: var(--win11-text-secondary);
    margin: 0;
  }

  .progress-bar {
    width: 100%;
    height: 6px;
    background: var(--win11-border);
    border-radius: 3px;
    overflow: hidden;
    margin-top: 8px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--win11-accent), #20c997);
    transition: width 0.3s ease;
  }

  .tips-section {
    background: linear-gradient(135deg, #fff3cd, #ffeaa7);
    border: 1px solid #ffecb5;
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
  }

  .tips-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .tips-icon {
    color: #856404;
    font-size: 16px;
  }

  .tips-title {
    font-size: 16px;
    font-weight: 600;
    color: #856404;
    margin: 0;
  }

  .tips-content {
    font-size: 14px;
    color: #664d03;
    margin: 0;
    line-height: 1.4;
  }

  @media (max-width: 1200px) {
    .dashboard-sections {
      grid-template-columns: 1fr;
    }
    
    .stats-grid {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .dashboard-header {
      padding: 20px;
    }
    
    .user-welcome {
      flex-direction: column;
      text-align: center;
    }
    
    .user-avatar {
      width: 64px;
      height: 64px;
    }
    
    .user-info h1 {
      font-size: 24px;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .quick-actions {
      grid-template-columns: 1fr;
    }
  }

  /* Activity Stream Styles */
  .activity-stream-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--win11-border);
  }

  .activity-stream-item:last-child {
      border-bottom: none;
  }

  .stream-avatar {
      flex-shrink: 0;
  }

  .stream-avatar .avatar-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
  }

  .avatar-placeholder {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--win11-hover);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--win11-text-secondary);
      font-size: 20px;
  }

  .stream-content {
      flex: 1;
      min-width: 0;
  }

  .stream-text {
      font-size: 14px;
      color: var(--win11-text-primary);
      line-height: 1.4;
      margin-bottom: 4px;
  }

  .stream-user {
      font-weight: 600;
      color: var(--win11-text-primary);
      text-decoration: none;
  }

  .stream-user:hover {
      color: var(--win11-accent);
      text-decoration: underline;
  }

  .stream-action {
      color: var(--win11-text-secondary);
      margin: 0 4px;
  }

  .stream-target {
      color: var(--win11-accent);
      text-decoration: none;
      font-weight: 500;
  }

  .stream-target:hover {
      text-decoration: underline;
  }

  .stream-time {
      font-size: 12px;
      color: var(--win11-text-secondary);
  }

  .stream-thumbnail {
      flex-shrink: 0;
  }

  .stream-thumbnail .thumbnail-img {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid var(--win11-border);
  }

</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="user-welcome">
      {% if request.user.profile.photo %}
        <img src="{{ request.user.profile.photo.url }}" alt="Profile Photo" class="user-avatar">
      {% else %}
        <div class="user-avatar">
          <i class="bi bi-person"></i>
        </div>
      {% endif %}
      <div class="user-info">
        <h1>Welcome back, {{ request.user.first_name|default:request.user.username }}!</h1>
        <p>Here's what's happening with your bookmarks today.</p>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  {% with total_images_created=request.user.images_created.count %}
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon images">
            <i class="bi bi-collection"></i>
          </div>
          <div class="stat-content">
            <h3>Images Bookmarked</h3>
            <div class="stat-number">{{ total_images_created }}</div>
            <p class="stat-description">Total image{{ total_images_created|pluralize }} saved</p>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {% if total_images_created %}{{ total_images_created|floatformat:0 }}%{% else %}5%{% endif %};"></div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon bookmarks">
            <i class="bi bi-bookmark-star"></i>
          </div>
          <div class="stat-content">
            <h3>Active Bookmarks</h3>
            <div class="stat-number">{{ total_images_created }}</div>
            <p class="stat-description">Ready to organize</p>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 75%;"></div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon activity">
            <i class="bi bi-graph-up"></i>
          </div>
          <div class="stat-content">
            <h3>This Week</h3>
            <div class="stat-number">12</div>
            <p class="stat-description">New bookmarks added</p>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 60%;"></div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon profile">
            <i class="bi bi-person-check"></i>
          </div>
          <div class="stat-content">
            <h3>Profile Status</h3>
            <div class="stat-number">{% if request.user.profile.photo %}100{% else %}75{% endif %}%</div>
            <p class="stat-description">Profile completion</p>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {% if request.user.profile.photo %}100{% else %}75{% endif %}%;"></div>
        </div>
      </div>
    </div>

    <!-- Main Dashboard Sections -->
    <div class="dashboard-sections">
      <!-- Main Content -->
      <div class="main-section">
        <div class="section-header">
          <h2 class="section-title">Bookmark Tool</h2>
          <p class="section-subtitle">Add the bookmarklet to your browser toolbar</p>
        </div>
        <div class="section-content">
          <div class="bookmarklet-container">
            <div class="bookmarklet-icon">
              <i class="bi bi-bookmark-plus"></i>
            </div>
            <div class="bookmarklet-title">Bookmark Images from Any Website</div>
            <div class="bookmarklet-description">
              Drag this button to your bookmarks toolbar to easily save images from any website you visit. 
              Click it while viewing any webpage to bookmark interesting images instantly.
            </div>
            <a href="javascript:(function(){
              var s=document.createElement('script');
              s.src='{{ request.scheme }}://{{ request.get_host }}{% static 'images/js/bookmarklet_launcher.js' %}?r='+Math.floor(Math.random()*99999999);
              document.body.appendChild(s);
            }());" class="bookmarklet-button">
              <i class="bi bi-bookmark-star" style="margin-right: 8px;"></i>
              Bookmark this Image
            </a>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <a href="{% url 'images:list' %}" class="action-button">
              <div class="action-icon">
                <i class="bi bi-collection"></i>
              </div>
              <span class="action-text">View Images</span>
            </a>
            <a href="{% url 'edit' %}" class="action-button">
              <div class="action-icon">
                <i class="bi bi-person-gear"></i>
              </div>
              <span class="action-text">Edit Profile</span>
            </a>
            <a href="#" class="action-button">
              <div class="action-icon">
                <i class="bi bi-people"></i>
              </div>
              <span class="action-text">Find People</span>
            </a>
            <a href="#" class="action-button">
              <div class="action-icon">
                <i class="bi bi-gear"></i>
              </div>
              <span class="action-text">Settings</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar-section">
        <div class="section-header">
          <h3 class="section-title">Recent Activity</h3>
          <p class="section-subtitle">Your latest actions</p>
        </div>
        <div class="recent-activity">
          <div class="activity-item">
            <div class="activity-icon">
              <i class="bi bi-image"></i>
            </div>
            <div class="activity-content">
              <p class="activity-title">Bookmarked new image</p>
              <p class="activity-time">2 hours ago</p>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="bi bi-person-gear"></i>
            </div>
            <div class="activity-content">
              <p class="activity-title">Updated profile</p>
              <p class="activity-time">1 day ago</p>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="bi bi-collection"></i>
            </div>
            <div class="activity-content">
              <p class="activity-title">Organized images</p>
              <p class="activity-time">3 days ago</p>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="bi bi-star"></i>
            </div>
            <div class="activity-content">
              <p class="activity-title">Joined Bookmarks</p>
              <p class="activity-time">1 week ago</p>
            </div>
          </div>
        </div>

        <!-- Tips Section -->
        <div class="tips-section">
          <div class="tips-header">
            <i class="bi bi-lightbulb tips-icon"></i>
            <h4 class="tips-title">Pro Tip</h4>
          </div>
          <p class="tips-content">
            Install our bookmarklet to save images 10x faster! Just drag the button above to your bookmarks bar.
          </p>
        </div>
      </div>
    </div>
    <div class="actions-section" style="margin-top: 32px;">
      <div class="main-section">
        <div class="section-header">
          <h2 class="section-title"> What's happening </h2>
        </div>
        <div class="section-content">
          {% for action in actions %}
            {% include "actions/action/detail.html" %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endwith %}
</div>
{% endblock %}